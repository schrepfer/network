# Configuration file for dnsmasq.
# ft=dnsmasq

port=53
listen-address={{ network_|addr:known_dns }}
listen-address=127.0.0.1
bind-interfaces

log-dhcp
log-facility=/var/log/dnsmasq.log

conf-file=/usr/share/dnsmasq-base/trust-anchors.conf
dnssec

cache-size=10000

expand-hosts
local=/{{ domain }}/
domain={{ domain }}

dhcp-range={{ network_|addr:dynamic.start }},{{ network_|addr:dynamic.end }},24h
dhcp-option=option:router,{{ gateway }}
dhcp-option=option:domain-name,{{ domain }}
dhcp-option=option:ntp-server,{{ ntp|network|join:"," }}
dhcp-option=tag:known,tag:!safe,option:dns-server,{{ network_|addr:known_dns }},{{ dns_servers|join:"," }}
dhcp-option=tag:!known,option:dns-server,{{ network_|addr:safe_dns }}
dhcp-authoritative
no-dhcp-interface=wlan0

no-resolv
{% for server in dns_servers %}
server={{ server }}{% endfor %}

auth-server=ns.{{ domain }}
auth-zone={{ domain }},{{ network }}
auth-soa={{ time|stringformat:"d" }},root.{{ domain }}
mx-host={{ domain }},mail.{{ domain }},10
address=/mail.{{ domain }}/{{ network_|addr:mail }}
address=/ns.{{ domain }}/{{ network_|addr:ns }}

# DHCP{% for host in hosts %}{% if host.ip and host.hardware %}
dhcp-host={{ host.hardware }},{% for tag in host.tags %}set:{{ tag }},{% endfor %}{{ network_|addr:host.ip }},24h{% endif %}{% endfor %}
